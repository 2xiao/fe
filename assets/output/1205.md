# [1205. 每月交易 II](https://leetcode.com/problems/monthly-transactions-ii)

🟠 <font color=#ffb800>Medium</font>&emsp; 🔖&ensp; [`数据库`](/tag/database.md)&emsp; 🔗&ensp;[`LeetCode`](https://leetcode.com/problems/monthly-transactions-ii)

## 题目

Table: `Transactions`

> 
> 
> 
> 
> 
> +----------------+---------+
> 
> | Column Name> 
> | Type> 
> |
> 
> +----------------+---------+
> 
> | id> 
> > 
> > 
>  | int> 
>  |
> 
> | country> 
> > 
> | varchar |
> 
> | state> 
> > 
>   | enum> 
> |
> 
> | amount> 
> > 
>  | int> 
>  |
> 
> | trans_date> 
>  | date> 
> |
> 
> +----------------+---------+
> 
> id is the column of unique values of this table.
> 
> The table has information about incoming transactions.
> 
> The state column is an ENUM (category) of type ["approved", "declined"].
> 
> 

Table: `Chargebacks`

> 
> 
> 
> 
> 
> +----------------+---------+
> 
> | Column Name> 
> | Type> 
> |
> 
> +----------------+---------+
> 
> | trans_id> 
>    | int> 
>  |
> 
> | trans_date> 
>  | date> 
> |
> 
> +----------------+---------+
> 
> Chargebacks contains basic information regarding incoming chargebacks from some transactions placed in Transactions table.
> 
> trans_id is a foreign key (reference column) to the id column of Transactions table.
> 
> Each chargeback corresponds to a transaction made previously even if they were not approved.



Write a solution to find for each month and country: the number of approved
transactions and their total amount, the number of chargebacks, and their
total amount.

**Note** : In your solution, given the month and country, ignore rows with all
zeros.

Return the result table in **any order**.

The result format is in the following example.



**Example 1:**

> Input: 
> 
> Transactions table:
> 
> +-----+---------+----------+--------+------------+
> 
> | id  | country | state> 
> | amount | trans_date |
> 
> +-----+---------+----------+--------+------------+
> 
> | 101 | US> 
>   | approved | 1000   | 2019-05-18 |
> 
> | 102 | US> 
>   | declined | 2000   | 2019-05-19 |
> 
> | 103 | US> 
>   | approved | 3000   | 2019-06-10 |
> 
> | 104 | US> 
>   | declined | 4000   | 2019-06-13 |
> 
> | 105 | US> 
>   | approved | 5000   | 2019-06-15 |
> 
> +-----+---------+----------+--------+------------+
> 
> Chargebacks table:
> 
> +----------+------------+
> 
> | trans_id | trans_date |
> 
> +----------+------------+
> 
> | 102> 
>   | 2019-05-29 |
> 
> | 101> 
>   | 2019-06-30 |
> 
> | 105> 
>   | 2019-09-18 |
> 
> +----------+------------+
> 
> Output: 
> 
> +---------+---------+----------------+-----------------+------------------+-------------------+
> 
> | month   | country | approved_count | approved_amount | chargeback_count | chargeback_amount |
> 
> +---------+---------+----------------+-----------------+------------------+-------------------+
> 
> | 2019-05 | US> 
>   | 1> 
> > 
> > 
>   | 1000> 
> > 
> > 
> | 1> 
> > 
> > 
> > 
> | 2000> 
> > 
> > 
>   |
> 
> | 2019-06 | US> 
>   | 2> 
> > 
> > 
>   | 8000> 
> > 
> > 
> | 1> 
> > 
> > 
> > 
> | 1000> 
> > 
> > 
>   |
> 
> | 2019-09 | US> 
>   | 0> 
> > 
> > 
>   | 0> 
> > 
> > 
>    | 1> 
> > 
> > 
> > 
> | 5000> 
> > 
> > 
>   |
> 
> +---------+---------+----------------+-----------------+------------------+-------------------+
> 
> 


## 题目大意

`Transactions` 记录表

> 
> 
> 
> 
> 
> +----------------+---------+
> 
> | Column Name> 
> | Type> 
> |
> 
> +----------------+---------+
> 
> | id> 
> > 
> > 
>  | int> 
>  |
> 
> | country> 
> > 
> | varchar |
> 
> | state> 
> > 
>   | enum> 
> |
> 
> | amount> 
> > 
>  | int> 
>  |
> 
> | trans_date> 
>  | date> 
> |
> 
> +----------------+---------+
> 
> id 是这个表的主键。
> 
> 该表包含有关传入事务的信息。
> 
> 状态列是枚举类型，值为 [approved、declined] 其中之一的列。

`Chargebacks` 表

> 
> 
> 
> 
> 
> +----------------+---------+
> 
> | Column Name> 
> | Type> 
> |
> 
> +----------------+---------+
> 
> | trans_id> 
>    | int> 
>  |
> 
> | trans_date> 
>  | date> 
> |
> 
> +----------------+---------+
> 
> 退单包含有关放置在事务表中的某些事务的传入退单的基本信息。
> 
> trans_id 是 transactions 表的 id 列的外键（reference 列）。
> 
> 每项退单都对应于之前进行的交易，即使未经批准。



编写一个解决方案，找出每个国家/地区的每月交易信息：已批准交易的数量及其总金额、退单的数量及其总金额。

**注意：** 在你的解决方案中，只需显示给定月份和国家，忽略所有为零的行。

以 **任意顺序** 返回结果表。

结果格式如下所示。



**示例 1:**

> 
> 
> 
> 
> 
> **输入：**
> 
> Transactions 表：
> 
> +-----+---------+----------+--------+------------+
> 
> | id  | country | state> 
> | amount | trans_date |
> 
> +-----+---------+----------+--------+------------+
> 
> | 101 | US> 
>   | approved | 1000   | 2019-05-18 |
> 
> | 102 | US> 
>   | declined | 2000   | 2019-05-19 |
> 
> | 103 | US> 
>   | approved | 3000   | 2019-06-10 |
> 
> | 104 | US> 
>   | declined | 4000   | 2019-06-13 |
> 
> | 105 | US> 
>   | approved | 5000   | 2019-06-15 |
> 
> +-----+---------+----------+--------+------------+
> 
> Chargebacks 表：
> 
> +----------+------------+
> 
> | trans_id | trans_date |
> 
> +----------+------------+
> 
> | 102> 
>   | 2019-05-29 |
> 
> | 101> 
>   | 2019-06-30 |
> 
> | 105> 
>   | 2019-09-18 |
> 
> +----------+------------+
> 
> **输出：**
> 
> +---------+---------+----------------+-----------------+------------------+-------------------+
> 
> | month   | country | approved_count | approved_amount | chargeback_count | chargeback_amount |
> 
> +---------+---------+----------------+-----------------+------------------+-------------------+
> 
> | 2019-05 | US> 
>   | 1> 
> > 
> > 
>   | 1000> 
> > 
> > 
> | 1> 
> > 
> > 
> > 
> | 2000> 
> > 
> > 
>   |
> 
> | 2019-06 | US> 
>   | 2> 
> > 
> > 
>   | 8000> 
> > 
> > 
> | 1> 
> > 
> > 
> > 
> | 1000> 
> > 
> > 
>   |
> 
> | 2019-09 | US> 
>   | 0> 
> > 
> > 
>   | 0> 
> > 
> > 
>    | 1> 
> > 
> > 
> > 
> | 5000> 
> > 
> > 
>   |
> 
> +---------+---------+----------------+-----------------+------------------+-------------------+


## 解题思路

#### 复杂度分析

- **时间复杂度**：`O()`，
- **空间复杂度**：`O()`，

## 代码

```javascript

```

## 相关题目

<!-- prettier-ignore -->
| 题号 | 标题 | 题解 | 标签 | 难度 |
| :------: | :------ | :------: | :------ | :------ |
| 1193 | [每月交易 I](https://leetcode.com/problems/monthly-transactions-i) |  |  [`数据库`](/tag/database.md) | <font color=#ffb800>Medium</font> |